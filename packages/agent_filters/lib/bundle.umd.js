!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@graphai/step_runner_agent_filter"),require("@graphai/stream_agent_filter"),require("@graphai/cache_agent_filter"),require("ajv"),require("graphai"),require("@graphai/agent_filter_utils")):"function"==typeof define&&define.amd?define(["exports","@graphai/step_runner_agent_filter","@graphai/stream_agent_filter","@graphai/cache_agent_filter","ajv","graphai","@graphai/agent_filter_utils"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).graphai_agent_filters={},e.step_runner_agent_filter,e.stream_agent_filter,e.cache_agent_filter,e.Ajv,e.graphai,e.agent_filter_utils)}(this,(function(e,t,r,n,a,i,o){"use strict";const s=(e,t,r,n)=>{if(!(new a).compile(e)(t))throw new Error(`${r}(${n??"func"}) schema not matched`);return!0};const u=async(e,t,r,n,a)=>{const i=async function*(e,t,r){const{params:n,namedInputs:a,debugInfo:i,filterParams:o}=t,s={params:n,debugInfo:i,filterParams:o,namedInputs:a},u={...r,"Content-Type":"text/event-stream"},c=await fetch(e,{headers:u,method:"POST",body:JSON.stringify(s)}),l=c.body?.getReader();if(200!==c.status||!l)throw new Error("Request failed");const f=new TextDecoder("utf-8");let g=!1;for(;!g;){const{done:e,value:t}=await l.read();if(e)g=e,l.releaseLock();else{const e=f.decode(t,{stream:!0});yield e}}}(t,r,n),o=[];for await(const t of i)a&&console.log(t),t&&(o.push(t),-1===o.join("").indexOf("___END___")&&e.filterParams.streamTokenCallback&&e.filterParams.streamTokenCallback(t));const s=o.join("").split("___END___")[1];return JSON.parse(s)};Object.defineProperty(e,"consoleStepRunner",{enumerable:!0,get:function(){return t.consoleStepRunner}}),Object.defineProperty(e,"stepRunnerGenerator",{enumerable:!0,get:function(){return t.stepRunnerGenerator}}),Object.defineProperty(e,"streamAgentFilterGenerator",{enumerable:!0,get:function(){return r.streamAgentFilterGenerator}}),Object.defineProperty(e,"cacheAgentFilterGenerator",{enumerable:!0,get:function(){return n.cacheAgentFilterGenerator}}),Object.defineProperty(e,"sortObjectKeys",{enumerable:!0,get:function(){return n.sortObjectKeys}}),Object.defineProperty(e,"agentFilterRunnerBuilder",{enumerable:!0,get:function(){return o.agentFilterRunnerBuilder}}),e.agentInputValidator=s,e.httpAgentFilter=async(e,t)=>{const{params:r,debugInfo:n,filterParams:a,namedInputs:o,config:s}=e;if(a?.server){const{baseUrl:t,isDebug:c,serverAgentUrlDictionary:l}=a.server,f=s?.headers??{};if(!i.isObject(f))throw new Error("httpAgentFilter: headers is not object.");const g=n.agentId,p=void 0!==a.streamTokenCallback,d=l&&g&&l[g]?l[g]:[t,g].join("/");void 0===d&&console.log("httpAgentFilter: Url is not defined");const _={params:r,debugInfo:n,filterParams:a,namedInputs:o,inputs:o};return p?await u(e,d,_,f,c):await(async(e,t,r)=>{const n={...r,"Content-Type":"application/json"},a=await fetch(e,{method:"post",headers:n,body:JSON.stringify(t)});return await a.json()})(d,_,f)}return t(e)},e.namedInputValidatorFilter=async(e,t)=>{const{inputSchema:r,namedInputs:n}=e,{agentId:a,nodeId:i}=e.debugInfo;return r&&"array"!==r.type&&s(r,n||{},i,a),t(e)}}));
//# sourceMappingURL=bundle.umd.js.map
